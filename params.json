{
  "name": "Barmanapi",
  "tagline": "This project convert from BARMAN command to RESTful  api. Barman API support full future and all versions of BARMAN. ",
  "body": "# PostgreSQL Barman RESTful Api\r\n[![Build Status](https://travis-ci.org/emin100/barman-api.svg?branch=master)](https://travis-ci.org/emin100/barmanapi)\r\n\r\nThis project convert from [BARMAN](http://www.pgbarman.org/ \"BARMAN\") command to RESTful  api. Barman API support full future and all versions of BARMAN. \r\n\r\n##Before you start\r\nBarman API needs a directory to store data.   \r\n  * Barman API Server       \r\n  ```api@barmanapi$ sudo mkdir /var/lib/barmanapi```          \r\n  ```api@barmanapi$ sudo chown user:user /var/lib/barmanapi```        \r\n  ```api@barmanapi$ sudo chown user:user /etc/barmanapi.conf```     \r\n  * Barman Server               \r\n  ```\r\n  barman@backup$ sudo chown barman:barman /etc/barman.conf\r\n  ```\r\n\r\n####Use with the BARMAN server and Barman API Server in the same machine\r\n  You don't need anything.\r\n####Use with the BARMAN server and Barman API Server in the diffrent machine\r\n  Barman API using SSH connection to BARMAN server. You must provide ssh connection BARAMAN Server and Barman API server with trust connection. \r\n######If you don't have a ssh keygen    \r\n  ```\r\n  api@barmanapi$ ssh-keygen\r\n  ```\r\n######Trust connection to BARMAN server\r\n  ```\r\n  api@barmanapi$ ssh-copy-id barman@backup\r\n  ```\r\n\r\n## System requirements\r\n\r\n  * Linux/Unix\r\n  * Python > 2.6\r\n  * Python modules:\r\n    * Flask\r\n    * Flask-HTTPAuth\r\n    * Flask-Script\r\n    * pyjwt\r\n  * ssh\r\n\r\n\r\n\r\n## INSTALL\r\n####From pip\r\n  ```\r\n  api@barmanapi$ sudo pip install barmanapi\r\n  ```\r\n\r\n####From source\r\n  ```\r\n  api@barmanapi$ git checkout https://github.com/emin100/barmanapi.git\r\n  ```       \r\n  ```\r\n  api@barmanapi$ cd barmanapi\r\n  ```       \r\n  ```\r\n  api@barmanapi$ sudo python setup.py install\r\n  ```\r\n   \r\n#### Default User\r\nBasic Auth default user\r\n\r\n<b>Username:</b>memin\r\n<b>Password:</b>1258\r\n\r\n####Start Server\r\n  ```\r\n  api@barmanapi$ barmanapi runserver\r\n  ```       \r\n<b>Note:</b> First usage, must call http://host:port/barman/reload?token=XX\r\n\r\n  \r\n## Basic configuration\r\n####Directory List\r\n######/var/lib/barmanapi/\r\n  Store BARMAN API data files.    \r\n  * archive: All active folder compress by month\r\n  * active : Async commands and results store in directory\r\n  * config : Barman commands and config parameter templates store in directory\r\n  * garbage: Temp directory\r\n  * logs   : All logs store in directory\r\n\r\n######/usr/share/barmanapi/\r\n  Store some config files     \r\n  * client.conf                     : Store user information. You can change this file location in barmanapi.conf file.\r\n  * man.conf                        : Store man parse options. Do not change this file location and content.\r\n  * template/config_change_template : Store code template.  Do not change this file location and content.\r\n\r\n####BARMAN API Config (/etc/barmanapi.conf)\r\n  ```\r\n  #Don't delete any option from this file. All option is using. If you don't need anyone, blank value this option\r\n  #User store location and pasword hash secret.\r\n  [user]\r\n  config_file=/usr/share/barmanapi/client.conf\r\n  #if change your secret all password is unusable. You must change all of password hash in user config_file\r\n  secret=89660c74da48ddd4efbe4d3c8f8150de\r\n    \r\n  [application]\r\n  store_directory=/var/lib/barmanapi/\r\n  host=0.0.0.0\r\n  port=1935\r\n  #In production, must be False debug parameter.\r\n  debug=True\r\n    \r\n  #Barman Server Settings\r\n  [barman]\r\n  config_file=/etc/barman.conf\r\n  command=/usr/bin/barman\r\n  remote=true\r\n  #If remote is false, you can blank remote_ssh option.\r\n  remote_ssh=ssh barman@backup\r\n  async_command=['backup','cron','recover']\r\n    \r\n  [auth_token]\r\n  secret=Deneme\r\n  algorithm=HS256\r\n  #Token life time(second). At the end of this time token is unusable.\r\n  token_life=6000\r\n    \r\n  [log]\r\n  #Stored last x log file\r\n  backup_count=5\r\n  #Log file truncate size(Bytes)\r\n  max_bytes=20000\r\n  ```\r\n  \r\n####Client config file\r\n  ```\r\n  [memin]\r\n  password = 26588e932c7ccfa1df309280702fe1b5\r\n  access = []\r\n  deny = []\r\n  ```\r\n  \r\nClient file is basic conf file. You can store password, access api urls and deny api urls.\r\n  * Section is a username(Like memin)\r\n  * Password hash with your secret (described in your barman api config file).\r\n  * access is an array.\r\n    * Blank array, user can call all APIS.\r\n    * Example access['barman','auth/user/list']. This example user access all /barman module api calls and only auth/user/list api call.\r\n  * deny is an array. \r\n    * Deny some api calls. Example deny['barman','auth/user/list']. User access out of this apis(All /barman module api calls and only auth/user/list api call). \r\n  \r\n## REST API\r\n#### Authentication & Authorization\r\nRest: /auth   \r\nAuth Model: Basic   \r\n######/auth/token\r\n<b>Auth:</b> Yes     \r\n<b>Parameters:</b> No  \r\n<b>Return:</b> token   \r\n\r\nGet a token for other rest api calls\r\n\r\n######/auth/user\r\n<b>Auth:</b> Yes   \r\n<b>Parameters:</b> No  \r\n<b>Return:</b> json list\r\n\r\nCurrent user access and deny parameters \r\n\r\n######/auth/user/list\r\n<b>Auth:</b> Yes   \r\n<b>Parameters:</b> No     \r\n<b>Return:</b> json list   \r\n\r\nGet rest user list\r\n######/auth/user/change\r\n<b>Auth:</b>Yes  \r\n<b>Parameters: </b>     \r\n  * username: Required      \r\n  * password        \r\n  * access      \r\n  * deny        \r\n\r\n<b>Return:</b> updated user properties  \r\n\r\nChange user properties    \r\n\r\n######/auth/user/add\r\n<b>Auth:</b>Yes   \r\n<b>Parameters: </b>   \r\n  * username: Required      \r\n  * password: Required      \r\n  * access      \r\n  * deny        \r\n\r\n<b>Return:</b> added user properties       \r\n\r\nAdd user    \r\n\r\n####CONFIG\r\nRest: /config   \r\nAuth Model: Token Based     \r\nDescription: You can change barman or barmanapi config file in rest api. If you want to use this future, you give write access to config files.     \r\n\r\n  * For Barman API      \r\n  ```\r\n  api@barmanapi$ sudo chown api:api /etc/barmanapi.conf\r\n  ```\r\n  * For Barman      \r\n  ```\r\n  barman@backup$ sudo chown barman:barman /etc/barman.conf\r\n  ```\r\n  \r\n######/config/barman\r\n<b>Auth:</b>Yes   \r\n<b>Parameters: </b>   \r\n  * token: Required\r\n\r\n<b>Return:</b> Barman configuration list.       \r\n\r\n######/config/barman/help\r\n<b>Auth:</b>Yes   \r\n<b>Parameters: </b>   \r\n  * token: Required\r\n\r\n<b>Return:</b> Barman configuration paramater list and descriptions.        \r\n\r\n######/config/barman/reload\r\n<b>Auth:</b>Yes   \r\n<b>Parameters: </b>   \r\n  * token: Required\r\n\r\n<b>Return:</b> Get Barman configuration parameters list and make configuration template\r\n\r\n######/config/barman/change\r\n<b>Auth:</b>Yes   \r\n<b>Parameters: </b>   \r\n  * token: Required\r\n\r\n<b>Return:</b> Change Barman configuration          \r\n<b>Example:</b>             \r\n  * http://host:port/config/barman/change?application.store_directory=/var/lib/barmanapi&token=XX       \r\n  * http://host:port/config/barman/change?barman.command=/usr/bin/barman&token=XX       \r\n  \r\n<b>Note:</b> Must be restart barman       \r\n\r\n######/config/barmanapi\r\n<b>Auth:</b>Yes   \r\n<b>Parameters: </b>   \r\n  * token: Required\r\n\r\n<b>Return:</b> Barman API configuration list\r\n\r\n######/config/barmanapi/change\r\n<b>Auth:</b>Yes   \r\n<b>Parameters: </b>   \r\n  * token: Required\r\n\r\n<b>Return:</b> Change Barman API configuration      \r\n<b>Example:</b>         \r\n  * http://host:port/config/barmanapi/change?barman.barman_user=barman&token=XX     \r\n  * http://host:port/config/barmanapi/change?main.description=blabla&token=XX       \r\n  \r\n<b>Note:</b> Must be restart barmanapi      \r\n\r\n####HISTORY\r\nRest: /history   \r\nAuth Model: Token Based     \r\n######/history/list\r\n<b>Auth:</b>Yes   \r\n<b>Parameters: </b>   \r\n  * token: Required     \r\n  * past: Optional - YYYYmm (Example : 201602). Get past archive history.       \r\n\r\n<b>Return:</b> async command result list        \r\n\r\nIn month executed async commands list. If you want to past history, you must be send past parameters.           \r\n<b>Example:</b>         \r\n  * http://host:port/history/list?token=XX\r\n  * http://host:port/history/list?past=201601&token=XX\r\n\r\n\r\n######/history/result\r\n<b>Auth:</b>Yes   \r\n<b>Parameters: </b>   \r\n  * token: Required     \r\n  * ticket: Required        \r\n\r\n<b>Return:</b> Sync command result       \r\n\r\nTicket related async command result.   \r\n\r\n\r\n####BARMAN API\r\nRest: /barman   \r\nAuth Model: Token Based   \r\n<b>Description:</b> Execute barman commands. If you want to see parameter list, you use /barman/command/help url or full api list /barman/help url.     \r\n\r\n<b>Example:</b>   \r\n  * http://host:port/barman/help?token=XX -> Return all usable commands, descriptions and parameters list       \r\n  * http://host:port/barman/backup/help?token=XX -> Return backup command description and parameters list       \r\n  * http://host:port/barman/backup?SERVERNAME=main&token=XX     \r\n  * http://host:port/barman/list-server?token=XX        \r\n\r\n\r\n\r\n\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}